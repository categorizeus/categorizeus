<html>
	<head>
		<script type="text/javascript" src="scripts/jquery-3.0.0.js"></script>
		<script type="text/javascript" src="scripts/handlebars-v4.0.5.js"></script>
		<script type="text/javascript" src="scripts/categorizeus.js"></script>
		<link rel="stylesheet" type="text/css" href="css/categorizeus.css"></script>
		<script id="tmplBasicDocument" type="text/x-handlebars-template">
			<div class="basicDocument" id="{{id}}">
				<h1>{{title}}</h1>
				<div class="postedBy">
					posted by {{postedBy.userName}}
					<input type="checkbox" name="{{id}}" class="chkTag"/>Tag this?
				</div>
				<div class="body">
					{{body}}
				</div>
			</div>
		</script>
		<script id="tmplBasicDocumentEdit" type="text/x-handlebars-template">
			<div class="basicDocumentEdit">
				<input class="inputMsgId" type="hidden" name="messageId" value="{{id}}"/>
				<p>Title <input class="inputMsgTitle" type="text" value="{{title}}"/></p>
				<p>Body <textarea class="inputMsgBody" rows="4" cols="87" type="text">{{body}}</textarea></p>
				<input type="button" class="inputMsgBtn" value="Submit"/>
			</div>
		</script>
		<script id="tmplLogin" type="text/x-handlebars-template">
			<div class="login">
				<p>Username <input class="txtUsername" type="text"/></p>
				<p>Password <input class="txtPassword" type="password"/></p>
				<input type="button" class="btnLogin" value="Login"/>
			</div>
		</script>
		<script id="tmplRegister" type="text/x-handlebars-template">
			<div class="register">
				<p>Username <input class="txtUsername" type="text"/></p>
				<p>Password <input class="txtPassword" type="password"/></p>
				<input type="button" class="btnRegister" value="Register"/>
			</div>
		</script>
		<script type="text/javascript">
			$(document).ready(function(){
				console.log("We're up");
				tmplBasicDocument = Handlebars.compile($("#tmplBasicDocument").html());
				tmplBasicDocumentEdit = Handlebars.compile($("#tmplBasicDocumentEdit").html());//notice the pattern
				tmplLogin = Handlebars.compile($("#tmplLogin").html());
				tmplRegister = Handlebars.compile($("#tmplRegister").html());

				$("#btnLoadDoc").click(function(){
					var id = $("#txtDocId").val();
					loadMessage(id, function(doc){
						$("#content").html(tmplBasicDocument(doc));
						displayEditForm("#editor", doc);
					});
				});


				$("#btnClearDoc").click(function(){
					displayEditForm("#editor", {});
				});

				$("#btnLogin").click(function(){
					displayLoginForm("#editor");
				});

				$("#btnRegister").click(function(){
					displayRegisterForm("#editor");
				});

				$("#btnTagLookup").click(function(){
					var tags = $("#txtTags").val();
					var allTags = tags.split(" ");
					var tagArray = [];
					for(var i=0; i<allTags.length;i++){
						if(allTags[i].length>0){
							tagArray.push(allTags[i]);
						}
					}
					tagSearch(tagArray, displayMessages);	
				});

				$("#btnTagMessages").click(function(){

					var tags = $("#txtTags").val();
					var allTags = tags.split(" ");
					var tagArray = [];
					for(var i=0; i<allTags.length;i++){
						if(allTags[i].length>0){
							tagArray.push(allTags[i]);
						}		}

					var whichTagged = [];
					$('input:checkbox.chkTag').each(function () {
						if(this.checked){
							whichTagged.push(this.name);
						}
					});
					console.log(whichTagged);
					if(tagArray.length==0){
						$("#status").html("<h1>Please provide tags when tagging</h1>");
						return;
					}
					if(whichTagged.length==0){
						$("#status").html("<h1>Please select messages when tagging</h1>");
						return;
					}
					tagMessages(tagArray, whichTagged);
				});


			});
		</script>
	</head>
	<body>
		<div id="status"></div>
		<div id="controls">
			<p>
			<input id="btnLogin" type="button" value="login"/>
			<input id="btnRegister" type="button" value="register"/>
			</p>
			<p>
			Document Id <input id = "txtDocId" type="text"/><input id="btnLoadDoc" type="button" value="load"/>
			<input id="btnClearDoc" type="button" value="create"/>
			</p>
			<p>
			Tags <input id="txtTags" type="text" width="101"/>
			<input id="btnTagLookup" type="button" value="tag search"/>
			<input id="btnTagMessages" type="button" value="tag selected"/>
			</p>
		</div>
		<div id="editor">
		</div>
		<div id="content">
			<h1>This is a very rudimentary viewer and editor for messages in the system.</h1>
		</div>
	</body>
</html>
